machine:
  services:
    - elasticsearch
database:
  override:
  - cp config/mongoid.yml.ci config/mongoid.yml
dependencies:
  cache_directories:
    - "js-library/node_modules"
    - "js-library/vendor"
test:
  override:
    - rspec spec-unit --profile
    - bundle exec rspec spec --profile
    - bundle exec rake konacha:load_poltergeist konacha:run
    - bundle exec rspec spec/acceptance --profile
    - bundle exec rspec spec/screenshots --profile
    - bundle exec brakeman --except SessionSettings -q -z
    - bin/check_assets_updated.sh
    - bundle exec rails_best_practices --silent
    - cd ../js-library; bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --clean
    - cd ../js-library; npm install; npm test
