<% content_for :specific_javascript do %>
  <script>
    var eventName = <%= event[:name].to_json.html_safe %>;
    var eventDetails = <%= event[:details].to_json.html_safe %>;

    if(window.opener) {
      var evt = document.createEvent('CustomEvent');
      evt.initCustomEvent(eventName, true, true, eventDetails);

      window.opener.document.dispatchEvent(evt);
      window.close();
    } else if (eventName !== 'account_error' && window.parent && window.parent.FactlinkApp && window.parent.FactlinkApp.FacebookRenewal) {
      // TODO Fix this, this shouldn't always be called. This makes no difference between a regular login and a facebook renewal
      window.parent.FactlinkApp.FacebookRenewal.success();
    } else {
      origin = '<%= request.env['omniauth.origin'] %>'
      if(origin !== ''){
        window.location = origin;
      }
    }
  </script>
<% end %>

<% content_for :account_popup_content do %>
  <h1 class="accounts-popup-heading">Redirecting you back to the application!</h1>
  <p class="accounts-popup-just-a-second">
    Just a second.
  </p>
<% end %>
