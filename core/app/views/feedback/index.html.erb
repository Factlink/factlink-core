<!doctype html>
<html>
  <head>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <%= render 'snippets/csrf' %>
    <%= stylesheet_link_tag "application" %>
    <%= javascript_include_base %>
    <%= inject_special_test_code %>
  </head>
  <script type="text/javascript">
    function updateHeight() {
      var $feedback_frame = window.parent.$('.js-feedback-resize');
      var $iframe = $feedback_frame.find('iframe');

      $iframe.css({
        height: $('body').outerHeight()
      });
    }

    function onCloseFrame() {
      $('.alert').each(function(i, el) {
        $(el).alert().alert('close');
      });
    }

    $(function () {
      updateHeight();
      $(window).on('resize', updateHeight);

      <% if params[:state] == 'success' %>

        if (window.parent.FactlinkApp) {
          window.parent.fadeoutFeedbackFrame();
          onCloseFrame();

          window.parent.Factlink.notificationCenter.success('Your feedback has successfully been submitted.');
        }
      <% end %>
    });
  </script>
  <body class="feedback_form">
    <p>
      Got stuck somewhere or is something not working properly? Just send us a quick note and we'll be on it.
    </p>

    <% if params[:state] %>
      <% if params[:state] == "error" %>
        <script>
          window.parent.parent.Factlink.notificationCenter.error('Something went wrong while submitting your feedback, did you fill in all the fields?');
        </script>
      <% end %>
    <% end %>

    <form action='https://factlink.sirportly.com/remote_form/<%= FactlinkUI::Application.config.sirportly_webform_id %>' method='POST'>
      <% if current_user %>
        <input type="hidden" name='ticket[name]'  id="ticket_name"  value="<%= current_user.username %>">
        <input type="hidden" name='ticket[email]' id="ticket_email" value="<%= current_user.email %>">
      <% else %>
        <input type="text" id="ticket_name"  name='ticket[name]' placeholder='Full name'>
        <input type="text" id="ticket_email" name='ticket[email]' placeholder='E-mail address'>
      <% end %>

      <input type="text" id="ticket_subject" name="ticket[subject]" placeholder="Message subject">
      <textarea  id="ticket_message" name="ticket[message]" placeholder="How can we be of service to you?"></textarea>

      <%= submit_tag "Send feedback", "data-disable-with" => "Sending feedback...", :class => "submit button-confirm", :name => "send" %>
    </form>
  </body>
</html>
