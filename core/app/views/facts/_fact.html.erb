<% modal ||= nil %>
<% channel ||= nil %>
<% view = FactsHelper::FactView.new(fact,current_user,channel) %>

<div class="fact-block" data-fact-id="<%= view.id %>">
  <% if view.deletable_from_channel? %>
    <%= view.link_to_delete_from_channel %>
  <% end %>
  
  <% if view.modal? %>
    <span class="close" onclick="parent.remote.hide();">x</span>
  <% end %>
  <%= render_mustache "/facts/fact_bubble", :fact => fact, :modal => modal, :form_authenticity_token => form_authenticity_token %>

  
  <div class="controls">
    <ul class="evidence">
      <li><a class="evidence-for">Evidence (<%= view.fact_relations_count %>)</a></li>
    </ul>
  </div>


  <div class="dropdown-container">
    <!-- default view - show the evidence for this fact -->
    <div class="page evidence-list" style="display: block;">
      <div class="evidence-list-wrapper">
        <% if can?:add_evidence,@fact %>
        <div class="notification">
          <span>Factlink is build on evidence. <a href"#" class="do-add">Add evidence to this Factlink</a></span>
        </div>
        <% end %>
        
        <div class="no-evidence-message">
          This Factlink is not supported or weakened by other Factlinks.<br/>
          <a href"#" class="do-add">Add evidence to this Factlink</a>
        </div>
        
        <div class="loading-evidence">
          <%= view.ajax_loader_image %> <span>Loading...</span>
        </div>
        
        <ul class="evidence-listing">
        </ul>
      </div>
    </div>
        
    <!-- show the evidence search results -->
    <div class="page evidence-search-results" style="display: none;">
      <div class="search-area">
        <form action="<%= view.evidence_search_path %>" data-remote="true" method="post">
          <a href="javascript:void();" class="back-to-evidence-listing">Back to evidence</a>
          <input type="text" class="evidence_search" name="s" placeholder="Search or add evidence" <%= view.prefilled_search_value %>>
          <input type="hidden" name="id" value="<%= view.id %>">
          <input type="submit" value="Search">
        </form>
      </div>

      <div class="results">
        <ul class="default-results">
          <li>
            Search or add evidence using the input above
          </li>
        </ul>
        
        <ul class="search-term-results" style="display:none;">
        </ul>
      </div>
      
      <!-- not implemented yet -->
      <div class="dropdown-underbar search-and-add-actions" style="display: none;">
        <ul>
          <% if view.modal? %>
            <li onclick="parent.openNewProxyWindow($('input.evidence_search').val());">
              Search the internet for "<span class="user-search-input"></span>"
            </li>
          <% end %>
          <li class="new-evidence-add-action">
            Add "<span class="user-search-input"></span>"
          </li>
        </ul>
      </div>
    </div>
    
    <!-- adding new evidence - including supporting / weakening buttons -->
    <div class="page new-evidence-add" style="display: none;">
      <form action="<%= view.evidence_index_path %>" data-remote="true" method="post">
        <a href="javascript:void();" class="back-to-search">Back to search</a>
        <span class="message">Add</span>
        <input id="fact_data_displaystring" name="fact_data[displaystring]" size="30" type="text">
        <input type="hidden" name="type" value="">
        <span class="message">To</span>
        <div class="fact evidence-bubble">
          <%= view.displaystring %>
        </div>
      </form>
      
      
      <div class="dropdown-underbar">
        <div class="add-actions">
          <button class="supporting btn">Add as supporting</button><button class="weakening btn">Add as weakening</button>
        </div>
      </div>
    </div>

    <!-- the actual adding - including supporting / weakening buttons -->
    <div class="page evidence-add" style="display: none;">
      <a href="javascript:void();" class="back-to-search">Back to search</a>
      <span class="message">Add</span>
      <div class="evidence evidence-bubble">
      </div>
      <span class="message">To</span>
      <div class="fact evidence-bubble">
        <%= view.displaystring %>
      </div>

      <div class="dropdown-underbar">
        <div class="add-actions">
          <button class="supporting btn">Add as supporting</button><button class="weakening btn">Add as weakening</button>
        </div>
      </div>
    </div>

  </div>
</div>
