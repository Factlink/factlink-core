<% content_for :javascript do %>
  <script>
    <%= render 'backbone/currentUser' %>

    var fact = new Fact(<%= Facts::Fact.for(fact: @fact, view: self, modal: @modal).to_json.html_safe %>);
    var view = new DiscussionView({
      model: fact
    });

    view.render();

    $('div.factlink-modal').append(view.el);

    <% if params[:guided] == "true" %>
    view.$('#close').tooltip({
      trigger: 'manual'
    }).tooltip('show');
    <% end %>

    parent.$(parent.document).trigger("modalready");

    window.fact_id = "<%= @fact.id %>";

    <% if @just_added %>
    parent.$(parent.document).trigger("factlinkCreated", <%= @fact.id %> );
    <% end %>

  </script>
<% end %>
