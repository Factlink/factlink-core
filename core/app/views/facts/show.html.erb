<% content_for :javascript do %>
  <script>
    <% if current_user %>
      window.currentUser = new User(<%= Users::User.for(user: current_user, view: self).to_json.html_safe %>);

      window.currentUser.setChannels(new OwnChannelCollection(<%= current_graph_user.channels.map{|ch| Channels::SingleMenuItem.for(channel: ch,view: self) }.to_json.html_safe %>));
    <% end %>

    var Fact = new Fact(<%= Facts::Fact.for(fact: @fact, view: self, modal: @modal).to_json.html_safe %>);
    var View = new FactView({
      model: Fact
    }).render();

    $('div.modal').append(View.el);
    window.fact_id = "<%= @fact.id %>";
  </script>
<% end %>

<% content_for :template do %>
  <%= load_mustache_templates %>
<% end %>