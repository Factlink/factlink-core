<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "tos" %>
<% end %>

<% content_for :notifications do %>
  <% if can? :sign_tos, current_user %>
    <% if current_user.errors.any? %>
      <div class="alert alert-error">
        <a class="close" data-dismiss="alert">Ã—</a>
        <ul>
        <% current_user.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
  <% end %>
<% end %>

<div id="tos">

  <%= render "terms_of_service" %>

  <% if can? :sign_tos, current_user %>
    <%= form_for(current_user, url: tos_path, method: "POST") do |f| %>

      <%= hidden_field_tag :tos_browser_name %>
      <%= hidden_field_tag :tos_browser_version %>

      <div class="row">
        <%= f.label "First name*" %>
        <div class="field">
          <%= f.text_field :tos_first_name, required: false %>
        </div>
      </div>

      <div class="row">
        <%= f.label "Last name*" %>
        <div class="field">
          <%= f.text_field :tos_last_name,  required: false %>
        </div>
      </div>

      <div class="row">
        <%= f.label "Email address*" %>
        <div class="field">
        <%= f.email_field :email, value: current_user ? current_user.email : "", required: true, readonly: true %>
        </div>
      </div>


      <div class="tos_checkbox">
        <%= f.check_box :agrees_tos, required: true %>
        <%= f.label :agrees_tos, "I accept the (pre) beta agreement and terms & conditions. *" %>
      </div>

      <div class="explanation">* fields are required</div>

      <div class="actions">
        <%= f.submit "Next", class: "btn btn-primary" %>
      </div>
    <% end %>
  <% else %>

    <% if current_user %>
    <div class="center">
      <%= link_to("Go back to your profile", user_profile_path(current_user)) %>
    </div>
    <% end %>
  <% end %>
</div>

<% content_for :javascript do %>
<script type="text/javascript">
  (function() {
    var tos_browser_name    = detectBrowser().browser;
    var tos_browser_version = detectBrowser().version;

    $('#tos_browser_name').val(tos_browser_name);
    $('#tos_browser_version').val(tos_browser_version);
  })();
</script>
<% end %>
