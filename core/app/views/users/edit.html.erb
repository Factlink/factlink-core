<header class="content-header">
  <div class="content-title">
    <h1>Edit</h1>
  </div>

  <div class="main-region-tabs">
    <ul>
      <li><%= link_to "About", user_profile_path(current_user) %></li>
      <li class="account active"><%= link_to "Edit", edit_user_path(current_user) %></li>
      <li class="password"><%= link_to "Change password", user_password_edit_path(current_user) %></li>
        <li class="tab-notification-settings"><%= link_to "Notification Settings", user_notification_settings_path(current_user) %></li>
    </ul>
  </div>

  <div class="clearfix"></div>
</header>

<div class="row" id="edit_user">
  <div class="narrow-indented-block content-region">
    <%= form_for(@user, :url => { action: :update, id: (@user.errors[:username].any? ? @user.username_was : @user.username) }, :html => { :class => "form-horizontal" }, validate: true) do |f| %>
      <div>
        <div class="control-group">
          <%= f.label :username, class: "control-label" %>
          <div class="controls">
            <%= f.text_field :username, autocomplete: "off", required: true, maxlength: 16, tabindex: 1 %>
          </div>
        </div>

        <div class="control-group">
          <%= f.label :full_name, class: "control-label" %>
          <div class="controls">
            <%= f.text_field :full_name, autocomplete: "off", tabindex: 2 %>
          </div>
        </div>

        <div class="control-group">
          <%= f.label :location, class: "control-label" %>
          <div class="controls">
            <%= f.text_field :location, autocomplete: "off", tabindex: 4 %>
          </div>
        </div>

        <div class="control-group">
          <%= f.label :biography, "Bio", class: "control-label" %>
          <div class="controls">
            <%= f.text_area :biography, autocomplete: "off", tabindex: 5, rows: 4 %>
          </div>
        </div>

        <% FactlinkUI::Application.config.social_services.each do |service_name| %>
          <%= render "social_services_button", service_name: service_name, f: f %>
        <% end %>

        <div class="control-group">
          <div class="controls controls-information-item">
            Note: We will not publish anything without your permission.
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">Picture</label>
          <div class="controls">
            <!-- TODO use proper avatar tags here using backbone -->
            <%= image_tag @user.avatar_url, class: "avatar" %>
            <span class="help-inline avatar">This image is automatically grabbed from <%= link_to "Gravatar", "http://gravatar.com", target: "_blank" %>. Edit your Gravatar account to edit the profile picture.<br><br>(we use <%= @user.email %>)</span>
          </div>
        </div>

        <div class="control-group">
          <%= f.label :email, class: "control-label" %>
          <div class="controls">
            <%= f.text_field :email, autocomplete: "off", disabled: true, class: "disabled-email" %>

            <span class="help-inline controls-information-item">To change your email address, please <a href="mailto:support@factlink.com">contact us</a>.</span>
          </div>
        </div>

        <div class="controls">
          <button type="submit" class="button-confirm controls-information-item" data-disable-with="Saving...">Save settings</button>
        </div>
      </div>
    <% end %>
  </div>

  <div class="narrow-indented-block edit-user-delete-container">

    <%= form_for(@user, method: :delete, html: { class: "form-horizontal" }) do |f| %>

      <div class="control-group">
        <div class="controls">
          <a class="edit-user-delete-link" href="javascript:$('.js-delete-form').toggle();">Delete account</a>
        </div>
      </div>

      <div class="js-delete-form hide">
        <div class="controls controls-information-item">
          Fill in your password to confirm deleting your account.
        </div>

        <div class="control-group">
          <%= f.label :password, class: "control-label" %>
          <div class="controls">
            <%= f.password_field :password, :autocomplete => "off", required: true %>
          </div>
        </div>

        <div class="controls">
          <button type="submit" class="button-danger controls-information-item">Delete my entire account</button>
          <span class="help-inline controls-information-item">Warning: all your data will be deleted</span>
        </div>
      </div>
    <% end %>
  </div>
</div>
