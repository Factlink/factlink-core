<!DOCTYPE html>
<html>
  <head>
    <title>Factlink</title>
    <%= stylesheet_link_tag "popup" %>

    <%= javascript_include_tag "modernizr-loader" %>
    <%= csrf_meta_tag %>

  </head>
  <body>

    <div id="container">
      <div id="header" class="row-fluid">
        <div class="span3">
          <%= link_to image_tag("factlink_logo71x15.png"), root_path, { target: "_blank" } %>
        </div>

        <div class="span9 pull-right" style="text-align: right;">
          <% unless user_signed_in? %>
               <%= link_to "Login to Factlink", new_user_session_path, { target: "_blank" } %>
          <% else %>
            <label class="btn" id="annotate_button">
              <input type="checkbox" name="annotate">
              Annotation mode
            </label>
          <% end %>
        </div>
      </div>
      <%= render 'home/notifications', notice: notice, alert: alert %>

      <%= yield %>
    </div>
  </body>

  <!-- JavaScript at the bottom for fast page loading -->

  <%= load_mustache_templates %>

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
  <%= javascript_include_tag "popup" %>

  <script>
    <% if current_user %>
      window.currentUser = new User(<%= Users::User.for(user: current_user, view: self).to_json.html_safe %>);

      window.currentUser.setChannels(new OwnChannelCollection(<%= current_graph_user.channels.map{|ch| Channels::Channel.for(channel: ch,view: self) }.to_json.html_safe %>));
    <% end %>

    var addToChannelView = new AddToChannelView({
      collection: currentUser.channels,
      el: $('#add_to_channels')
    }).render();
  </script>

  <%= yield :javascript %>
</html>
