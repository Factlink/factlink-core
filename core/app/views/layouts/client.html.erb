<!DOCTYPE html>
<html>
<head>
  <%= stylesheet_link_tag "client" %>

  <title><%= "Factlink: \"#{@title}\"" || "Factlink modal window" %></title>

  <style type="text/css">
    html, body{
      width: 100%;
      height: 100%;
      background: transparent;
    }
  </style>

  <%= javascript_include_tag "modernizr-loader" %>
  <%= csrf_meta_tag %>
</head>
<body class="client">
  <div id='alerts'></div>

  <div class="factlink-modal">
    <div class="drag-handler top"   ></div>
    <div class="drag-handler bottom"></div>
    <div class="drag-handler left"  ></div>
    <div class="drag-handler right" ></div>
    <%= yield %>
  </div>

  <div id='modal_region'></div>
  <%= yield :template %>


  <%= javascript_include_tag "modal" %>

  <script type="text/javascript">
    Factlink.allowFeatures(<%= current_ability.feature_toggles.to_s.html_safe %>);
  </script>


  <script type="text/javascript">
    FactlinkApp.startAsClient();
    <% if params[:guided] == "true" %>
      // turn on guided globally in this backbone session
      FactlinkApp.guided = true;
    <% else %>
      FactlinkApp.guided = false;
    <% end %>
    <%= render 'backbone/currentUser' %>
  </script>

  <%= yield :javascript %>

  <script type="text/javascript">
    $(".factlink-modal").draggable({handle: '.drag-handler'});
    $( document ).bind('click', function(e) {
      if( $(e.target).is('body') )
        parent.remote.hide();
    });
  </script>

</body>
</html>
