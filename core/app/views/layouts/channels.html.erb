<!-- header -->
<%= content_for :header do %>
<% end %>

<!-- left column -->
<%= content_for :left_column do %>
  <%= render :partial => "home/snippets/user_li", :locals => { :user => @user } %>
  <%= render :partial => "channels/channels", :locals => {:user => @user } %>
<% end %>

<!-- right-column -->
<%= content_for :right_column do %>
  <%= render :partial => "channels/related_users",
             :locals => {
               :related_users => @channel.related_users(:without=>[current_graph_user]).andand.map{|x| x.user },
               :excluded_users => [@channel.created_by.user]
              } %>
<% end %>

<%= content_for :javascript do %>
  <%= javascript_include_tag "models/channel.js" %>
  <%= javascript_include_tag "collections/channels.js" %>
  <%= javascript_include_tag "collections/facts.js" %>
  <%= javascript_include_tag "views/channel_menu_view.js" %>
  <%= javascript_include_tag "views/channel_app_view.js" %>
  <%= javascript_include_tag "router.js" %>
  
  <script>    
    var Router = new Workspace();
    
    Backbone.history.start({pushState:true, silent:true});
    
    Channels.reset(<%= @user.graph_user.channels.map{|ch| ChannelsHelper::ChannelModelView.new(ch) }.to_json.html_safe%>);
  </script>
  
  <script>
  	$('.follow-channel').bind('click', function() {
  		$.ajax({
  		  url: $(this).data('follow-url'),
  			dataType: "script",
  		  success: function(){
  				console.log("Succes");
  		  }
  		});

  		return false;
  	});
  </script>
<% end %>

<%= content_for :template do %>
  <script type="text/html" id="channel_li">
    <%= template_as_string "channels/_single_menu_item.html.mustache" %>
    <%# render :partial => "channels/single_menu_item", :locals => { :jsmode => true } %>
  </script>
<% end %>

<%= render :template => 'layouts/frontend' %>