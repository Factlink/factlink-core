<% content_for :javascript do %>
  <%= javascript_include_tag "backbone/contrib.js" %>
  <%= javascript_include_tag "backbone/models/user.js" %>
  <%= javascript_include_tag "backbone/models/channel.js" %>
  <%= javascript_include_tag "backbone/models/fact.js" %>
  <%= javascript_include_tag "backbone/collections/channels.js" %>
  <%= javascript_include_tag "backbone/collections/own_channel_collection.js" %>
  <%= javascript_include_tag "backbone/collections/facts.js" %>
  <%= javascript_include_tag "backbone/views/own_channel_item_view.js" %>
  <%= javascript_include_tag "backbone/views/add_to_channel_view.js" %>
  <%= javascript_include_tag "backbone/views/channel_collection_view.js" %>
  <%= javascript_include_tag "backbone/views/facts_view.js" %>
  <%= javascript_include_tag "backbone/views/fact_view.js" %>
  <%= javascript_include_tag "backbone/views/channel_view.js" %>
  <%= javascript_include_tag "backbone/views/user_view.js" %>
  <script>
    var results = new Facts(<%= @results.to_json.html_safe %>, {
      search: "<%= params[:s] %>"
    });
    
    var factsView = new FactsView({
      collection: results
    }).render();
        
    $('#results-listing').append(factsView.el);
  </script>
<% end %>


<% content_for :left_column do %>
	<%= user_signed_in? ? render("users/user_li", user: current_user ) : "&nbsp;".html_safe %>

<% end %>

<% content_for :main_column do %>
	<h1>Factlink search - providing credibility you can see</h1>

	<% unless @results.count > 0 %>

		<div class="append-bottom">
				<p>Your search didn't return any matching results.</p> <p>Perhaps you should refine your search?</p>
		</div>
		
	<% else %>
    <ul id="results-listing">
    </ul>
	<% end %>
<% end %>

<% content_for :template do %>
  <%= load_js_template "user_block_tmpl",         "users/_user.html.mustache" %>
  <%= load_js_template "own_channels_collection", "channels/_own_channel_listing.html.mustache" %>
  <%= load_js_template "own_channel_li",          "channels/_own_channel.html.mustache" %>
  <%= load_js_template "fact_tmpl",               "facts/_fact.html.mustache" %>
  <%= load_js_template "fact_bubble_tmpl",        "facts/_fact_bubble.html.mustache" %>
  <%= load_js_template "fact_wheel_tmpl",         "facts/_fact_wheel.html.mustache" %>
  <%= load_js_template "facts_tmpl",              "channels/_facts.html.mustache" %>
<% end %>