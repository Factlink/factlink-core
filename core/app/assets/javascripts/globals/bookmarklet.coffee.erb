#= require './globals'

<%
  bookmarklet_url = FactlinkUI::Application.config.jslib_url + '?o=bookmarklet'

  def minify_js(s)
    res = s
    res = res.gsub(/^\s*\/\/[^\n]*\n/, '')
    res = res.gsub(/\s+/, ' ')
    res
  end

  bookmarklet = minify_js '
    (function(){
      var script = document.createElement("script");
      script.src = "' + bookmarklet_url + '";
      script.onload = function(){ __internalFactlinkState("bookmarkletLoaded"); };
      document.head.appendChild(script);
    })();'
%>

Factlink.Global.bookmarklet_link = 'javascript:' + <%= bookmarklet.to_json %>
