@import "bootstrap/mixins";

// Layout variables
@middleColumnWidth: 100px;
@topFactWheelOverhang: 62px;
@middleLineWidth: 3px;
@impactCircleDiameter: 53px;
@argumentBoxTopOverhang: 12px;
@impactCircleTopSpacing: 30px;
@evidenceBoxSpacing: 15px;
@impactColouredBorderWidth: 3px;
@evidenceRegionHorizontalMargin: 16px;
@evidenceRegionBottomPadding: 60px;

// Arrows:
@impactCircleVotableWithoutArrowsTopSpacing: 15px;
@arrowInnerSpacing: 8px;
@arrowWidth: 21px;
@arrowHeight: 12px;

// Triangles:
// - An inner triangle with the box's background color
// - An outer triangle "fake border" that's 1px offset
@innerTriangleOffset: @triangleSize - 1px;
@triangleTop: floor(@impactCircleDiameter/2) + @argumentBoxTopOverhang;

// The dicussion page has 3 columns, 2x 50% and one fixed - so more than 100% total.
// This means we need some negative margins to make it fit.
@negativeColumnMargin: @middleColumnWidth/2;

// Evidence boxes are after impact circles in DOM, but are pulled up so their
// visual top is above the impact circle top.
@evidenceBoxTopOffset: -(@impactCircleDiameter + @argumentBoxTopOverhang);


// It would look weird for the evidence boxes to end before the impact circles.
// Therefore, the supporting/weaking boxes need a minimum height.
@evidenceBoxMinHeight: 2 * @argumentBoxTopOverhang + @impactCircleDiameter;


@unsureImpactToBoxDistance: @impactCircleTopSpacing/2 + @triangleSize;

// The unsure (middle) box needs to leave space for the impact circle since its
// impact circle cannot be floated (both left/right would be problematic).
@unsureImpactRelativeTop: -@impactCircleDiameter
                          - @unsureImpactToBoxDistance
                          + @impactCircleTopSpacing
                          - @argumentBoxTopOverhang;

.evidence-container {
  padding: 0 @negativeColumnMargin @evidenceRegionBottomPadding;
  margin: @topFactWheelOverhang @evidenceRegionHorizontalMargin 0;
  box-sizing: content-box;
}

.evidence-list {
  position: relative;
}

.evidence-line-background {
  position: absolute;
  left: 50%;
  width: 0px;
  margin-left: -(floor(@middleLineWidth/2));
  z-index: -2;
  top: -@topFactWheelOverhang;
  bottom: 0;
  box-shadow: 0 0 80px 100px @semiTransparentLayerColor;
  visibility: visible;

  .evidence-line {
    position: absolute;
    left: 0;
    width: @middleLineWidth;
    top: 0;
    bottom: 0;
    background: @discussionLineColor;
  }
}

.evidence-terminator {
  clear: both;
}

.evidence-impact, .evidence-box {
  position: relative;
  .box-sizing(border-box);
  visibility: visible;
}

.evidence-impact {
  .white-block-with-shadow();
  width:  @impactCircleDiameter;
  height: @impactCircleDiameter;
  border-radius: 1000px;
}

.evidence-impact-text {
  .new-design-font();
  font-size: @heading1FontSize;
  line-height: @impactCircleDiameter;
  text-align: center;
}

.evidence-box {
  width: 50%;
}

.evidence-supporting > .evidence-box, .evidence-weakening > .evidence-box {
  margin: @evidenceBoxTopOffset -@negativeColumnMargin @evidenceBoxSpacing -@negativeColumnMargin;
  min-height: @evidenceBoxMinHeight;
}

.evidence-supporting, .evidence-loading {
  > .evidence-impact, > .evidence-box {
    float: right;
    clear: right;
  }

  > .evidence-impact {
    margin-top: @impactCircleTopSpacing;
    position: relative;
    margin-right: 50%;
    right: ceil(-@impactCircleDiameter/2);
  }
}

.evidence-weakening {
  > .evidence-impact, > .evidence-box {
    float: left;
    clear: left;
  }

  > .evidence-impact {
    margin-top: @impactCircleTopSpacing;
    position: relative;
    margin-left: 50%;
    left: floor(-@impactCircleDiameter/2);
  }
}

.evidence-unsure {
  > .evidence-impact, > .evidence-box {
    margin: auto;
    clear: both;
  }

  > .evidence-impact {
    top: @unsureImpactRelativeTop;
    margin-bottom: @unsureImpactRelativeTop;
  }

  > .evidence-box {
    margin-top: @unsureImpactToBoxDistance;
    margin-bottom: @evidenceBoxSpacing;
    position: relative;
  }

  > .evidence-spacer-left,
  > .evidence-spacer-right {
    width: 0;
    visibility: hidden;
    height: @impactCircleTopSpacing - @unsureImpactRelativeTop;
  }
  > .evidence-spacer-left  { float: left; }
  > .evidence-spacer-right { float: right; }

  .discussion-interacting-users:after {
    content: "";
    display: block;
    width: 3px;
    height: 100% + 7px;
    background-color: #f5f5f6;
    position: absolute;
    top: -7px;
    left: 50%;
    margin-left: -1px;   
  }
}

// Irrelevant (faded out)
.evidence-irrelevant > .evidence-box {
  opacity: 0.6;
  .transition(opacity 0.2s);

  &:hover {
    opacity: 0.9;
  }
}

// Coloured half-circles
.evidence-impact::after {
  content: '';
  position: absolute;
  top:    -@impactColouredBorderWidth;
  bottom: -@impactColouredBorderWidth;
  left:   -@impactColouredBorderWidth;
  right:  -@impactColouredBorderWidth;
}

.evidence-supporting > .evidence-impact::after {
  left: ceil(@impactCircleDiameter/2) - 1px;
  border-top-right-radius:    1000px;
  border-bottom-right-radius: 1000px;

  border: @impactColouredBorderWidth solid @supportingImpactColor;
  border-left: none;
}

.evidence-weakening > .evidence-impact::after {
  right: floor(@impactCircleDiameter/2) - 2px;
  border-top-left-radius:    1000px;
  border-bottom-left-radius: 1000px;
  border: @impactColouredBorderWidth solid @weakeningImpactColor;
  border-right: none;
}

.evidence-unsure > .evidence-impact::after {
  top: floor(@impactCircleDiameter/2) - 1px;
  border-bottom-left-radius:  1000px;
  border-bottom-right-radius: 1000px;
  border: @impactColouredBorderWidth solid @unsureImpactColor;
  border-top: none;
}

// Evidence triangles (arrows)
.evidence-supporting .evidence-box-triangle,
.evidence-weakening .evidence-box-triangle {
  top: @triangleTop;
  margin-top: -@triangleSize;
}

.evidence-supporting .evidence-box-triangle {
  .triangle-arrow-left();
  left: 0;
}

.evidence-weakening .evidence-box-triangle {
  .triangle-arrow-right();
  right: 0;
}

.evidence-unsure .evidence-box-triangle {
  .triangle-arrow-up();
  top: 0;
  left: 50%;
  margin-left: -@triangleSize;
}

// Voting arrows
.evidence-impact-vote {
  position: absolute; // needs to be positioned for popover
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
}

.evidence-votable > .evidence-impact {
  margin-top: @impactCircleTopSpacing + @impactCircleVotableWithoutArrowsTopSpacing;
}

@arrowAdditionalSpacing: @arrowHeight + @arrowInnerSpacing;
.evidence-votable.evidence-has-arrows > .evidence-impact {
  margin-top: @impactCircleTopSpacing + @arrowAdditionalSpacing;
  margin-bottom: @arrowAdditionalSpacing;
}

.evidence-votable.evidence-has-arrows > .evidence-box {
  margin-top: @evidenceBoxTopOffset - @arrowAdditionalSpacing;
}

.evidence-impact-vote-up, .evidence-impact-vote-down {
  width: @arrowWidth;
  height: @arrowHeight;
  position: absolute;
  left: @impactCircleDiameter/2 - @arrowWidth/2 + 1px;

  display: none;
}

.evidence-impact-vote-up {
  background: asset-data-url( 'evidence-arrows/up-arrow-unclicked.png');
  top: -@arrowHeight - @arrowInnerSpacing;

  &:hover {
    background: asset-data-url('evidence-arrows/up-arrow-unclicked-hover.png');
  }

  &.active {
    background: asset-data-url('evidence-arrows/up-arrow-clicked.png');

    &:hover {
      background: asset-data-url('evidence-arrows/up-arrow-clicked-hover.png');
    }
  }
}

.evidence-impact-vote-down {
  background: asset-data-url('evidence-arrows/down-arrow-unclicked.png');
  bottom: -@arrowHeight - @arrowInnerSpacing;

  &:hover {
    background: asset-data-url('evidence-arrows/down-arrow-unclicked-hover.png');
  }

  &.active {
    background: asset-data-url('evidence-arrows/down-arrow-clicked.png');

    &:hover {
      background: asset-data-url('evidence-arrows/down-arrow-clicked-hover.png');
    }
  }
}

.evidence-votable {
  .evidence-impact-vote-up, .evidence-impact-vote-down {
    display: block;
  }
}

.evidence-impact-vote-popover {
  z-index: 1; // force it just above the other evidence, inside this stacking context
}

// Add evidence buttons
@weakeningLineOffset: 4px + -ceil(@middleLineWidth/2);
@supportingLineOffset: 4px + floor(@middleLineWidth/2);
@evidenceAddLinesTop: 3px;
@evidenceAddCircleExtraRadius: 1px;
@evidenceAddLineLength: 45px;

.evidence-add {
  min-height: 220px; // to accommodate for the fact relation search
  display: none;
}

.evidence-container-loaded {
  .evidence-add {
    display: block;
  }

  .evidence-terminator-before-add-evidence {
    height: 80px;
  }

  .evidence-terminator-circle {
    position: relative;
    min-height: 30px;

    @circleRadius: @middleLineWidth + 2*@evidenceAddCircleExtraRadius;
    &:after {
      content: '';
      display: block;
      position: absolute;
      bottom: -@circleRadius - (@evidenceAddLinesTop - @evidenceAddCircleExtraRadius);
      left: 50%;
      margin-left: -2px;
      width: @circleRadius;
      height: @circleRadius;
      border-radius: 5px; //half would be enough
      background-color: @discussionLineColor;
      visibility: visible;
    }
  }
}

.evidence-add-buttons {
  position: relative;
}

.evidence-add-weakening-line, .evidence-add-supporting-line {
  position: absolute;
  top: @evidenceAddLinesTop;
  height: @middleLineWidth;
  width: @evidenceAddLineLength + 5px; // some extra length to avoid rounding issues
  background-color: @discussionLineColor;
  visibility: visible;
}

.evidence-add-weakening-line {
  right: 50%;
  margin-right: @weakeningLineOffset;
}

.evidence-add-supporting-line {
  left: 50%;
  margin-left: @supportingLineOffset;
}

.evidence-add-weakening, .evidence-add-supporting {
  width:  @impactCircleDiameter;
  height: @impactCircleDiameter;
  border-radius: 1000px;

  position: absolute;
  top: -@impactCircleDiameter/2 + @evidenceAddLinesTop + ceil(@middleLineWidth/2);
  background: asset-data-url('icon-pencil.png') no-repeat 15px 16px;
  cursor: pointer;
  transition: all 0.1s;
  visibility: visible;
}

.evidence-add-weakening {
  right: 50%;
  margin-right: @evidenceAddLineLength + @weakeningLineOffset;
  background-color: @buttonDangerBackground;
  box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonDangerBorder;

  &:hover {
    background-color: @buttonDangerDarkBackground;
    box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonDangerDarkBorder;
  }

  &:active {
    background-color: @buttonDangerDarkBackground;
    border-top: @largeButtonBorderWidth solid @buttonDangerDarkBorder;
    box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonDangerDarkBackground;
  }
}

.evidence-add-supporting {
  left: 50%;
  margin-left: @evidenceAddLineLength + @supportingLineOffset;
  background-color: @buttonSuccessBackground;
  box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonSuccessBorder;

  &:hover {
    background-color: @buttonSuccessDarkBackground;
    box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonSuccessDarkBorder;
  }

  &:active {
    background-color: @buttonSuccessDarkBackground;
    border-top: @largeButtonBorderWidth solid @buttonSuccessDarkBorder;
    box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonSuccessDarkBackground;
  }
}

.evidence-add .evidence-impact {
  margin-top: -@impactCircleDiameter/2;
  cursor: pointer;

  background-color: white;
  box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonBorder;
  transition: box-shadow 0.1s, border-top 0.1s;

  &:hover {
    box-shadow: @blockBorder, 0 @largeButtonBorderWidth @buttonDarkBorder;
  }

  &:active {
    border-top: @largeButtonBorderWidth solid @buttonDarkBorder;
    box-shadow: @blockBorder, 0 @largeButtonBorderWidth white;
  }
}

.evidence-add-cross {
  width:  @impactCircleDiameter;
  height: @impactCircleDiameter;
  border-radius: 1000px;

  background: asset-data-url('icon-cross.png') no-repeat 17px 17px;
  opacity: 0.4;
}

.evidence-impact:hover .evidence-add-cross {
  opacity: 0.6;
}
