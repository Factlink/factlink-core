#!/bin/bash

MY_DIR=`dirname $0`
. $MY_DIR/lib.sh


branchname=`current_branch_name`


fetch_screenshots(){
  job=$1
  extra_dirs=$2
  screenshots=`ls $MY_DIR/../spec/screenshots/screenshots/*.png`
  for screenshot in $screenshots; do
    write_file="spec/screenshots/screenshots/$screenshot"
    fetch_url="https://$CREDENTIALS@$JENKINS_HOSTNAME/$extra_dirs""job/$job/ws/tmp/capybara/$screenshot"

    wget  "$fetch_url" -O "$write_file"
  done
}

case $branchname in
  develop )
    fetch_screenshots "DevelopCore" ""
    ;;
  feature/* )
    job=`jenkins_job_for_feature_branch "$branchname"`
    fetch_screenshots "$job" "view/5%20-%20Features/"
    ;;
  master )
    echo "please don't update screenshots directly in master"
    ;;
  * )
    echo "Unrecognized type of branch"
    ;;
esac
#wget --user=$JENKINS_USER --ask-password https://ci.factlink.com/job/DevelopCore/ws/tmp/capybarascreenshot-$1-new.png -O spec/screenshots/screenshots/$1.png
