general:
  build_dir: core

machine:
  services:
    - elasticsearch
dependencies:
  cache_directories:
    - "~/factlink/js-library/node_modules"
    - "~/factlink/js-library/vendor"
  post:
    - cd ~/factlink/js-library; bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --clean
    - cd ~/factlink/js-library; npm install
test:
  override:
    - bundle exec rspec spec --profile
    - bundle exec rake konacha:load_poltergeist konacha:run
    - cd ~/factlink/js-library; grunt
    - bundle exec rspec spec/acceptance spec/screenshots --profile
    - KENNISLAND= bundle exec rspec spec/acceptance spec/screenshots --profile
    - bin/copy_received_fixtures_for_circleci.sh
    - bundle exec brakeman --except SessionSettings -q -z
    - bundle exec scss-lint app/assets/stylesheets/ --config ../.scss-lint.yml
    - bundle exec scss-lint ../js-library/app/css/ --config ../.scss-lint.yml
    - bin/check_assets_updated.sh
    - bundle exec rails_best_practices --silent
